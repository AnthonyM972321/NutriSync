<!-- Barcode Scanner -->
                <div style="background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">üì± Scanner de Code-barres</h3>
                    <p style="margin-bottom: 20px;">Scannez le code-barres d'un produit pour l'ajouter instantan√©ment depuis Open Food Facts</p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn" style="background: white; color: #ff5722;" onclick="startBarcodeScanner()">
                            üì∑ Scanner un produit
                        </button>
                        <input type="text" id="barcodeInput" placeholder="Ou entrez le code-barres" style="flex: 1; min-width: 200px; color: #333;">
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="searchByBarcode()">
                            Rechercher
                        </button>
                    </div>
                </div>

                <div class="photo-analysis">
                    <h3 style="margin-bottom: 10px;">üì∏ Analyse de Photo Repas (GPT-4 Vision)</h3>
                    <p>Prenez une photo de votre repas pour une estimation automatique des calories et nutriments par IA</p>
                    <div class="photo-upload-area" onclick="document.getElementById('photoInput').click()">
                        <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="analyzeFood(event)">
                        <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                        <p>Cliquez ou glissez une photo ici</p>
                        <p style="font-size: 14px; opacity: 0.8;">JPG, PNG ‚Ä¢ Max 5MB ‚Ä¢ Analyse par GPT-4 Vision</p>
                    </div>
                    <div class="alert alert-info" style="margin-top: 15px; background: rgba(255,255,255,0.2); color: white;">
                        üí° <strong>Nouveau :</strong> L'IA peut maintenant identifier plusieurs aliments sur une m√™me photo !
                    </div>
                </div>

                <div style="background: #7c3aed; color: white; padding: 25px; border-radius: 15px;">
                    <h3 style="margin-bottom: 10px;">üìã Scan Intelligent d'√âtiquettes (OCR)</h3>
                    <p>Photographiez l'√©tiquette nutritionnelle d'un produit pour l'ajouter automatiquement</p>
                    <button class="btn" style="background: white; color: #7c3aed; margin-top: 15px;">
                        üì∏ Scanner une √©tiquette
                    </button>
                </div>

                <!-- Smart Suggestions -->
                <div style="background: #e8f5e9; padding: 25px; border-radius: 15px; margin-top: 30px;">
                    <h3 style="color: #2e7d32; margin-bottom: 15px;">üí° Suggestions Intelligentes</h3>
                    <p style="color: #388e3c; margin-bottom: 20px;">Aliments recommand√©s pour compl√©ter vos macros du jour</p>
                    <div id="smartSuggestions" style="display: grid; gap: 15px;">
                        <!-- Suggestions will be generated here -->
                    </div>
                    <button class="btn btn-success" style="margin-top: 15px;" onclick="generateSmartSuggestions()">
                        Actualiser les suggestions
                    </button>
                </div>

                <!-- Favorite Recipes -->
                <div style="background: #fff3e0; padding: 25px; border-radius: 15px; margin-top: 30px;">
                    <h3 style="color: #e65100; margin-bottom: 15px;">‚≠ê Recettes Favorites</h3>
                    <div id="favoriteRecipes" style="margin-bottom: 15px;">
                        <p style="color: #666;">Aucune recette favorite pour le moment</p>
                    </div>
                    <button class="btn" style="background: #ff6f00; color: white;" onclick="showCreateRecipeModal()">
                        ‚ûï Cr√©er une recette
                    </button>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page-section">
                <h2 class="page-title">üìä Analytics</h2>
                
                <!-- Weight Evolution -->
                <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">üìà √âvolution du poids (30 derniers jours)</h3>
                    
                    <div style="background: #f5f5f5; padding: 40px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
                        <p style="color: #666; margin-bottom: 20px;">Graphique de l'√©volution du poids</p>
                        <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 20px;">
                            <div>
                                <p style="color: #666; font-size: 14px;">Poids initial: <strong>96.2kg</strong></p>
                            </div>
                            <div>
                                <p style="color: #666; font-size: 14px;">Poids actuel: <strong>93.3kg</strong></p>
                            </div>
                            <div>
                                <p style="color: #4caf50; font-size: 14px;">Variation: <strong>-2.8kg</strong></p>
                            </div>
                        </div>
                        <canvas id="weightChart" width="400" height="200" style="max-width: 100%;"></canvas>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4 style="margin-bottom: 15px;">√âvolution du poids</h4>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="newWeight" placeholder="Poids actuel (kg)" style="flex: 1;" step="0.1">
                            <button class="btn btn-success" onclick="addWeightEntry()">Ajouter</button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; background: #f5f5f5; padding: 40px; border-radius: 12px; text-align: center;">
                        <p style="color: #666;">Graphique d'√©volution du poids</p>
                    </div>
                </div>
                
                <!-- Progress Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #2196f3; color: white; padding: 25px; border-radius: 15px; text-align: center;">
                        <h2 style="font-size: 48px; margin-bottom: 10px;">0</h2>
                        <p style="font-size: 18px;">Jours cons√©cutifs</p>
                        <p style="font-size: 14px; opacity: 0.8;">Record: 0 jours</p>
                    </div>
                    <div style="background: #4caf50; color: white; padding: 25px; border-radius: 15px; text-align: center;">
                        <h2 style="font-size: 48px; margin-bottom: 10px;">0%</h2>
                        <p style="font-size: 18px;">Objectifs atteints</p>
                        <p style="font-size: 14px; opacity: 0.8;">Cette semaine</p>
                    </div>
                </div>
                
                <!-- AI Features -->
                <div style="background: #f3f0ff; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #7c3aed; margin-bottom: 20px;">üöÄ Fonctionnalit√©s IA activ√©es</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0;">‚úì Chat conversationnel (ChatGPT)</li>
                        <li style="padding: 8px 0;">‚úì G√©n√©ration de recettes personnalis√©es</li>
                        <li style="padding: 8px 0;">‚úì Images de plats (DALL-E 3)</li>
                        <li style="padding: 8px 0;">‚úì Analyse photo repas (GPT-4 Vision)</li>
                        <li style="padding: 8px 0;">‚úì Scan OCR √©tiquettes</li>
                        <li style="padding: 8px 0;">‚úì Planning repas automatique</li>
                        <li style="padding: 8px 0;">‚úì Coaching intensif IA</li>
                        <li style="padding: 8px 0;">‚úì Pr√©dictions personnalis√©es</li>
                    </ul>
                </div>
                
                <!-- Personalization -->
                <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">üé® Personnalisation</h3>
                    
                    <div class="form-group">
                        <label>Taille des verres d'eau</label>
                        <select id="glassSize" onchange="updateGlassSize()">
                            <option value="25">25cl (petit verre)</option>
                            <option value="33">33cl (canette)</option>
                            <option value="50">50cl (grande bouteille)</option>
                            <option value="75">75cl (bouteille sport)</option>
                            <option value="100">100cl (1 litre)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Objectif d'hydratation journalier</label>
                        <input type="number" id="hydrationGoal" value="200" min="100" max="500" step="10" onchange="updateHydrationGoal()">
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">En centilitres (cl)</p>
                    </div>
                </div>
                
                <!-- Data Management -->
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;">Gestion des Donn√©es</h3>
                    
                    <div style="background: linear-gradient(135deg, #26d0ce 0%, #1a2980 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;">üíæ Sauvegarde & Synchronisation</h4>
                        <p style="margin-bottom: 15px;">Vos donn√©es sont automatiquement sauvegard√©es et synchronis√©es via JSONStorage.</p>
                        <p style="font-size: 14px; opacity: 0.8; margin-bottom: 20px;">Taille des donn√©es : <span id="dataSize">0.47 KB</span></p>
                        <p style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; margin-bottom: 20px;">
                            üîÑ Derni√®re synchronisation : <span id="lastSync">Il y a quelques secondes</span>
                        </p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="exportData()">
                                üì• Exporter les donn√©es
                            </button>
                            <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="importData()">
                                üì§ Importer les donn√©es
                            </button>
                            <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="forceSync()">
                                ‚òÅÔ∏è Forcer la sync
                            </button>
                            <button class="btn" style="background: rgba(255,0,0,0.2); color: white;" onclick="resetData()">
                                üîÑ R√©initialiser
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <h4 style="margin-bottom: 20px;">üìÑ Export & Rapports</h4>
                        <p style="color: #666; margin-bottom: 20px;">G√©n√©rez des rapports d√©taill√©s de votre progression</p>
                        
                        <div style="display: grid; gap: 15px;">
                            <button class="btn btn-primary" style="width: 100%;" onclick="generateWeeklyReport()">
                                üìä Rapport hebdomadaire
                            </button>
                            <button class="btn btn-primary" style="width: 100%;" onclick="generateMonthlyReport()">
                                üìä Rapport mensuel
                            </button>
                            <button class="btn btn-primary" style="width: 100%;" onclick="exportCSV()">
                                üìÑ Export CSV
                            </button>
                            <button class="btn btn-primary" style="width: 100%;" onclick="generatePDF()">
                                üìÑ G√©n√©rer PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Coach Page -->
            <div id="ai-coach" class="page-section">
                <h2 class="page-title">Assistant IA Nutritionnel (ChatGPT)</h2>
                <p style="color: #666; margin-bottom: 20px;">Conversation intelligente avec votre coach nutritionnel personnel</p>

                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message ai">
                            <p><strong>ü§ñ Coach IA</strong></p>
                            <p>Bonjour ! Je suis votre coach nutritionnel IA personnel. Comment puis-je vous aider aujourd'hui ?</p>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Posez votre question nutritionnelle...">
                        <button class="chat-send-btn" onclick="sendMessage()">
                            ‚û§
                        </button>
                    </div>
                </div>

                <div style="margin-top: 40px; background: #f5f5f5; padding: 30px; border-radius: 15px;">
                    <h3 style="margin-bottom: 20px;">üîç G√©n√©rateur de Recettes IA avec Images (DALL-E 3)</h3>
                    <p style="color: #666; margin-bottom: 20px;">G√©n√©rez des recettes sur mesure avec photos app√©tissantes cr√©√©es par IA</p>
                    
                    <div class="macro-inputs">
                        <div class="form-group">
                            <label>Calories cibles</label>
                            <input type="number" id="recipeCalories" value="500" min="100" max="2000">
                        </div>
                        <div class="form-group">
                            <label>Prot√©ines (g)</label>
                            <input type="number" id="recipeProteins" value="30" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label>Glucides (g)</label>
                            <input type="number" id="recipeCarbs" value="40" min="0" max="200">
                        </div>
                        <div class="form-group">
                            <label>Lipides (g)</label>
                            <input type="number" id="recipeFats" value="20" min="0" max="100">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Type de repas :</label>
                        <select id="mealType">
                            <option value="breakfast">ü•ê Petit-d√©jeuner</option>
                            <option value="lunch">üçù D√©jeuner</option>
                            <option value="dinner">üçñ D√Æner</option>
                            <option value="snack">üçì Collation</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Restrictions alimentaires :</label>
                        <div class="restriction-options">
                            <div class="restriction-option">
                                <input type="checkbox" id="vegetarian">
                                <label for="vegetarian">ü•¨ V√©g√©tarien</label>
                            </div>
                            <div class="restriction-option">
                                <input type="checkbox" id="vegan">
                                <label for="vegan">üå± Vegan</label>
                            </div>
                            <div class="restriction-option">
                                <input type="checkbox" id="glutenFree">
                                <label for="glutenFree">üåæ Sans gluten</label>
                            </div>
                            <div class="restriction-option">
                                <input type="checkbox" id="lactoseFree">
                                <label for="lactoseFree">ü•õ Sans lactose</label>
                            </div>
                            <div class="restriction-option">
                                <input type="checkbox" id="lowCarb">
                                <label for="lowCarb">üçû Low-carb</label>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="generateRecipe()">
                        ‚ú® G√©n√©rer une recette
                    </button>
                </div>
            </div>

            <!-- Planning Page -->
            <div id="planning" class="page-section">
                <h2 class="page-title">üìÖ Planification Repas IA</h2>
                
                <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 40px; border-radius: 20px; text-align: center;">
                    <h3 style="font-size: 24px; margin-bottom: 15px;">ü§ñ G√©n√©ration automatique par IA</h3>
                    <p style="font-size: 16px; opacity: 0.9; margin-bottom: 25px;">
                        Notre IA g√©n√®re un planning complet de repas √©quilibr√©s adapt√©s √† vos objectifs, pr√©f√©rences et restrictions alimentaires.
                    </p>
                    <button class="btn" style="background: white; color: #11998e; font-size: 18px; padding: 15px 40px;" onclick="generateWeekPlan()">
                        ‚ú® G√©n√©rer ma semaine
                    </button>
                </div>

                <div id="weekPlan" style="margin-top: 30px; display: none;">
                    <!-- Week plan will be generated here -->
                </div>
            </div>

            <!-- Courses Page -->
            <div id="courses" class="page-section">
                <h2 class="page-title">üõí Liste de Courses</h2>
                <div class="empty-state">
                    <div class="empty-state-icon">üõí</div>
                    <h3>Votre liste de courses appara√Ætra ici</h3>
                    <p>G√©n√©rez d'abord un planning de repas pour cr√©er votre liste de courses automatiquement</p>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="showPage('planning')">
                        Cr√©er un planning
                    </button>
                </div>
            </div>

            <!-- Coaching Page -->
            <div id="coaching" class="page-section">
                <h2 class="page-title">üéØ Coaching</h2>
                <div class="empty-state">
                    <div class="empty-state-icon">üèãÔ∏è</div>
                    <h3>Votre programme de coaching personnalis√©</h3>
                    <p>Bient√¥t disponible</p>
                </div>
            </div>

            <!-- Cloud Page -->
            <div id="cloud" class="page-section">
                <h2 class="page-title">‚òÅÔ∏è Cloud</h2>
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">üîÑ Synchronisation Cloud</h3>
                    <p style="color: #666; margin-bottom: 20px;">Vos donn√©es sont automatiquement synchronis√©es via JSONStorage</p>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #1976d2; margin-bottom: 10px;">üìä Statut de synchronisation</h4>
                        <p>‚úÖ Synchronisation active</p>
                        <p>üîó Code de sync : <strong id="cloudSyncCode">NUTRI-XXXXX</strong></p>
                        <p>üìÖ Derni√®re sync : <span id="cloudLastSync">Il y a quelques secondes</span></p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="forceSync()">
                        üîÑ Forcer la synchronisation
                    </button>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page-section">
                <h2 class="page-title">‚öôÔ∏è Param√®tres</h2>
                
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 25px;">üîß Int√©grations API</h3>
                    
                    <div class="form-group">
                        <label>Cl√© API OpenAI (GPT-4 & DALL-E 3)</label>
                        <input type="text" placeholder="sk-..." id="openaiKey">
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">Pour chat IA, g√©n√©ration de recettes, analyse photos et images</p>
                    </div>

                    <div class="form-group">
                        <label>Google Vision API</label>
                        <input type="text" placeholder="Cl√© API Google Vision" id="googleVisionKey">
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">Pour OCR scan d'√©tiquettes nutritionnelles</p>
                    </div>

                    <div class="form-group">
                        <label>Stability AI (Alternative DALL-E)</label>
                        <input type="text" placeholder="Cl√© API Stability" id="stabilityKey">
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">Pour g√©n√©ration d'images de recettes (alternative)</p>
                    </div>

                    <div class="form-group">
                        <label>Google Fit API</label>
                        <input type="text" placeholder="Cl√© API Google Fit" id="googleFitKey">
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">Pour synchroniser vos donn√©es d'activit√© physique</p>
                    </div>

                    <div class="form-group">
                        <label>FatSecret API</label>
                        <input type="text" placeholder="Cl√© API FatSecret" id="fatSecretKey">
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">Base de donn√©es alimentaire internationale (alternative)</p>
                    </div>
                    
                    <div class="form-group">
                        <label>Edamam API</label>
                        <input type="text" placeholder="Cl√© API Edamam" id="edamamKey">
                        <p style="font-size: 14px; color: #666; margin-top: 5px;">Analyse nutritionnelle et base de donn√©es de recettes</p>
                    </div>

                    <button class="btn btn-success" style="width: 100%; margin-top: 20px;" onclick="saveSettings()">
                        Sauvegarder les param√®tres
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="addFoodModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter un aliment personnalis√©</h3>
                <span class="modal-close" onclick="closeModal('addFoodModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>Nom de l'aliment</label>
                <input type="text" id="foodName" placeholder="Ex: Poulet grill√©">
            </div>
            <div class="form-group">
                <label>Quantit√© (g)</label>
                <input type="number" id="foodQuantity" value="100">
            </div>
            <div class="form-group">
                <label>Calories</label>
                <input type="number" id="foodCalories" placeholder="165">
            </div>
            <div class="form-group">
                <label>Prot√©ines (g)</label>
                <input type="number" id="foodProteins" placeholder="31">
            </div>
            <div class="form-group">
                <label>Glucides (g)</label>
                <input type="number" id="foodCarbs" placeholder="0">
            </div>
            <div class="form-group">
                <label>Lipides (g)</label>
                <input type="number" id="foodFats" placeholder="3.6">
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="addCustomFood()">
                Ajouter l'aliment
            </button>
        </div>
    </div>

    <!-- Create Recipe Modal -->
    <div id="createRecipeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cr√©er une recette favorite</h3>
                <span class="modal-close" onclick="closeModal('createRecipeModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>Nom de la recette</label>
                <input type="text" id="recipeName" placeholder="Ex: Salade prot√©in√©e">
            </div>
            <div class="form-group">
                <label>Ingr√©dients (un par ligne)</label>
                <textarea id="recipeIngredients" rows="5" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;" placeholder="100g poulet grill√©&#10;50g quinoa&#10;200g l√©gumes verts"></textarea>
            </div>
            <div class="form-group">
                <label>Type de repas</label>
                <select id="recipeMealType">
                    <option value="breakfast">Petit-d√©jeuner</option>
                    <option value="lunch">D√©jeuner</option>
                    <option value="dinner">D√Æner</option>
                    <option value="snack">Collation</option>
                </select>
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="saveRecipe()">
                Sauvegarder la recette
            </button>
        </div>
    </div>

    <!-- Barcode Result Modal -->
    <div id="barcodeResultModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Produit trouv√©</h3>
                <span class="modal-close" onclick="closeModal('barcodeResultModal')">&times;</span>
            </div>
            <div id="barcodeProductInfo">
                <!-- Product info will be displayed here -->
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="addBarcodeProduct()">
                Ajouter ce produit
            </button>
        </div>
    </div>

    <!-- Sync Code Modal -->
    <div id="syncModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîó Synchroniser avec un code existant</h3>
                <span class="modal-close" onclick="closeModal('syncModal')">&times;</span>
            </div>
            <div class="sync-form">
                <p style="margin-bottom: 20px;">Entrez votre code de synchronisation pour r√©cup√©rer vos donn√©es :</p>
                <div class="sync-input-group">
                    <input type="text" id="existingSyncCode" placeholder="NUTRI-XXXXX" style="text-transform: uppercase;">
                    <button class="btn btn-primary" onclick="syncWithCode()">
                        üîÑ Synchroniser
                    </button>
                </div>
                <div class="alert alert-warning" style="margin-top: 20px;">
                    ‚ö†Ô∏è <strong>Attention :</strong> Cela remplacera toutes vos donn√©es actuelles !
                </div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="success-message">
        ‚úì Enregistr√© avec succ√®s !
    </div>

    <script>
        // State management with JSONStorage integration
        let appState = {
            syncCode: null,
            lastSync: null,
            user: {
                gender: 'homme',
                age: 31,
                height: 180,
                weight: 96,
                goal: 'cut',
                activity: 'light',
                proteinPercent: 30,
                fatPercent: 25,
                carbPercent: 45
            },
            nutrition: {
                calories: 0,
                proteins: 0,
                carbs: 0,
                fats: 0,
                targetCalories: 1836,
                targetProteins: 138,
                targetCarbs: 206,
                targetFats: 51
            },
            hydration: {
                glasses: 0,
                targetGlasses: 8,
                glassVolume: 25,
                dailyGoal: 200
            },
            meals: [],
            weekPlan: null,
            weightHistory: [],
            streak: 0,
            settings: {
                glassSize: 25,
                hydrationGoal: 200,
                apiKeys: {} // API keys stored locally only
            },
            fasting: {
                isActive: false,
                startTime: null,
                targetHours: 16,
                elapsed: 0
            },
            recipes: [],
            progressPhotos: {
                before: null,
                after: null
            },
            voiceCoach: {
                isActive: false,
                language: 'fr-FR'
            },
            micronutrients: {
                vitamins: {
                    A: 0, C: 0, D: 0, E: 0, K: 0,
                    B1: 0, B2: 0, B3: 0, B6: 0, B12: 0
                },
                minerals: {
                    calcium: 0, iron: 0, magnesium: 0,
                    phosphorus: 0, potassium: 0, sodium: 0,
                    zinc: 0, copper: 0, selenium: 0
                }
            }
        };

        // Auto-save timer
        let autoSaveInterval = null;
        let syncInProgress = false;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeSync();
            updateCurrentDate();
            initializeHydration();
            updateDashboard();
            loadFromLocalStorage();
            initializeWeightChart();
            updateDataSize();
            
            // Start auto-save every 30 seconds
            startAutoSave();
        });

        // Sync Functions
        function generateSyncCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = 'NUTRI-';
            for (let i = 0; i < 5; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function initializeSync() {
            // Check if we have a sync code in localStorage
            const storedCode = localStorage.getItem('nutriSyncCode');
            
            if (storedCode) {
                appState.syncCode = storedCode;
                loadFromCloud(storedCode);
            } else {
                // Generate new sync code
                appState.syncCode = generateSyncCode();
                localStorage.setItem('nutriSyncCode', appState.syncCode);
                saveToCloud();
            }
            
            updateSyncUI();
        }

        function updateSyncUI() {
            const syncCodeElements = document.querySelectorAll('#syncCode, #cloudSyncCode');
            syncCodeElements.forEach(el => {
                if (el) el.textContent = appState.syncCode;
            });
            
            const lastSyncElements = document.querySelectorAll('#lastSync, #cloudLastSync');
            lastSyncElements.forEach(el => {
                if (el && appState.lastSync) {
                    const timeDiff = Date.now() - appState.lastSync;
                    const seconds = Math.floor(timeDiff / 1000);
                    const minutes = Math.floor(seconds / 60);
                    const hours = Math.floor(minutes / 60);
                    
                    if (hours > 0) {
                        el.textContent = `Il y a ${hours} heure${hours > 1 ? 's' : ''}`;
                    } else if (minutes > 0) {
                        el.textContent = `Il y a ${minutes} minute${minutes > 1 ? 's' : ''}`;
                    } else {
                        el.textContent = 'Il y a quelques secondes';
                    }
                }
            });
        }

        async function saveToCloud() {
            if (syncInProgress) return;
            
            syncInProgress = true;
            updateSyncBadge('syncing');
            
            try {
                // Prepare data (exclude sensitive info)
                const dataToSync = {
                    ...appState,
                    settings: {
                        ...appState.settings,
                        apiKeys: {} // Don't sync API keys
                    }
                };
                
                // Save to JSONStorage
                const response = await fetch(`https://api.jsonstorage.net/v1/json/${appState.syncCode}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSync)
                });
                
                if (response.ok) {
                    appState.lastSync = Date.now();
                    updateSyncBadge('success');
                    updateSyncUI();
                } else {
                    // If PUT fails, try POST (first time)
                    const postResponse = await fetch('https://api.jsonstorage.net/v1/json', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSync)
                    });
                    
                    if (postResponse.ok) {
                        appState.lastSync = Date.now();
                        updateSyncBadge('success');
                        updateSyncUI();
                    } else {
                        updateSyncBadge('error');
                    }
                }
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncBadge('error');
            } finally {
                syncInProgress = false;
            }
        }

        async function loadFromCloud(syncCode) {
            try {
                const response = await fetch(`https://api.jsonstorage.net/v1/json/${syncCode}`);
                
                if (response.ok) {
                    const cloudData = await response.json();
                    
                    // Merge with local state (preserve API keys)
                    const localApiKeys = appState.settings.apiKeys;
                    appState = {
                        ...cloudData,
                        settings: {
                            ...cloudData.settings,
                            apiKeys: localApiKeys
                        }
                    };
                    
                    updateDashboard();
                    initializeHydration();
                    updateAllUI();
                    
                    showSuccess('Donn√©es synchronis√©es depuis le cloud !');
                }
            } catch (error) {
                console.error('Load error:', error);
            }
        }

        function updateSyncBadge(status) {
            const badge = document.getElementById('syncBadge');
            const statusText = document.getElementById('syncStatus');
            
            if (!badge || !statusText) return;
            
            switch (status) {
                case 'syncing':
                    badge.className = 'sync-badge syncing';
                    statusText.textContent = 'Synchronisation...';
                    break;
                case 'success':
                    badge.className = 'sync-badge';
                    statusText.textContent = 'Donn√©es synchronis√©es';
                    break;
                case 'error':
                    badge.className = 'sync-badge error';
                    statusText.textContent = 'Erreur de sync';
                    break;
            }
        }

        function toggleSyncInfo() {
            const infoBox = document.getElementById('syncInfoBox');
            infoBox.classList.toggle('show');
        }

        function copySyncCode() {
            const code = appState.syncCode;
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target;
                btn.textContent = '‚úì Copi√© !';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = 'üìã Copier';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function showSyncModal() {
            document.getElementById('syncModal').classList.add('active');
        }

        async function syncWithCode() {
            const code = document.getElementById('existingSyncCode').value.trim().toUpperCase();
            
            if (!code || !code.startsWith('NUTRI-')) {
                alert('Code invalide. Le format doit √™tre NUTRI-XXXXX');
                return;
            }
            
            if (confirm('Cela remplacera toutes vos donn√©es actuelles. Continuer ?')) {
                localStorage.setItem('nutriSyncCode', code);
                appState.syncCode = code;
                await loadFromCloud(code);
                closeModal('syncModal');
                location.reload();
            }
        }

        function startAutoSave() {
            // Save every 30 seconds
            autoSaveInterval = setInterval(() => {
                saveToCloud();
                saveToLocalStorage();
            }, 30000);
        }

        function forceSync() {
            saveToCloud();
            showSuccess('Synchronisation forc√©e !');
        }

        // Update current date
        function updateCurrentDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const today = new Date().toLocaleDateString('fr-FR', options);
            document.getElementById('currentDate').textContent = today;
        }

        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Save to cloud when changing pages
            saveToCloud();
        }

        // All other functions remain the same...
        // [Rest of the JavaScript code continues with all the original functions]

        // Hydration tracking
        function initializeHydration() {
            const container = document.getElementById('hydrationGlasses');
            if (!container) return;
            
            container.innerHTML = '';
            
            for (let i = 0; i < appState.hydration.targetGlasses; i++) {
                const glass = document.createElement('div');
                glass.className = 'glass';
                glass.onclick = () => toggleGlass(i);
                if (i < appState.hydration.glasses) {
                    glass.classList.add('filled');
                }
                container.appendChild(glass);
            }
            
            updateHydrationStatus();
        }

        function toggleGlass(index) {
            if (index === appState.hydration.glasses - 1) {
                appState.hydration.glasses--;
            } else if (index === appState.hydration.glasses) {
                appState.hydration.glasses++;
            }
            
            initializeHydration();
            updateDashboard();
            saveToCloud();
        }

        function resetHydration() {
            appState.hydration.glasses = 0;
            initializeHydration();
            updateDashboard();
            saveToCloud();
            showSuccess('Hydratation r√©initialis√©e');
        }

        function updateHydrationStatus() {
            const totalCl = appState.hydration.glasses * appState.hydration.glassVolume;
            const statusEl = document.getElementById('hydrationStatus');
            if (statusEl) {
                statusEl.textContent = `${appState.hydration.glasses}/8 verres = ${totalCl}cl`;
            }
        }

        // Dashboard updates
        function updateDashboard() {
            // Update calories
            updateElement('consumedCalories', appState.nutrition.calories);
            updateElement('remainingCalories', appState.nutrition.targetCalories - appState.nutrition.calories);
            
            // Update progress bars
            updateProgressBar('calories', appState.nutrition.calories, appState.nutrition.targetCalories);
            updateProgressBar('proteins', appState.nutrition.proteins, appState.nutrition.targetProteins);
            updateProgressBar('hydration', 
                appState.hydration.glasses * appState.hydration.glassVolume, 
                appState.hydration.dailyGoal
            );
            
            // Update progress text
            updateElement('caloriesProgress', `${appState.nutrition.calories} / ${appState.nutrition.targetCalories}`);
            updateElement('proteinsProgress', `${appState.nutrition.proteins}g / ${appState.nutrition.targetProteins}g`);
            updateElement('hydrationProgress', 
                `${appState.hydration.glasses * appState.hydration.glassVolume}cl / ${appState.hydration.dailyGoal}cl`
            );
        }

        function updateElement(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        function updateProgressBar(type, current, target) {
            const percentage = Math.min((current / target) * 100, 100);
            const bar = document.getElementById(`${type}Bar`);
            if (bar) bar.style.width = percentage + '%';
        }

        // [Continue with all other original functions...]
        // The rest of the JavaScript remains the same as the original
        
        // Add all the remaining functions from the original code here
        // (updateMacros, calculateProteinRatio, calculateNeeds, saveProfile, etc.)

        // Profile and calculations
        function updateMacros() {
            const proteinPercent = parseInt(document.getElementById('proteinSlider').value);
            const fatPercent = parseInt(document.getElementById('fatSlider').value);
            const carbPercent = 100 - proteinPercent - fatPercent;
            
            document.getElementById('proteinPercent').textContent = proteinPercent;
            document.getElementById('fatPercent').textContent = fatPercent;
            document.getElementById('carbPercent').textContent = carbPercent;
            
            appState.user.proteinPercent = proteinPercent;
            appState.user.fatPercent = fatPercent;
            appState.user.carbPercent = carbPercent;
        }

        function calculateProteinRatio() {
            const weight = parseFloat(document.getElementById('weight').value);
            const proteinPerKg = parseFloat(document.getElementById('proteinPerKg').value);
            const totalProtein = weight * proteinPerKg;
            
            const estimatedCalories = appState.nutrition.targetCalories || 2000;
            const proteinCalories = totalProtein * 4;
            const proteinPercent = Math.round((proteinCalories / estimatedCalories) * 100);
            
            document.getElementById('proteinRatioResult').textContent = 
                `R√©sultat : ${proteinPercent}% de prot√©ines`;
            
            document.getElementById('proteinSlider').value = proteinPercent;
            updateMacros();
        }

        function calculateNeeds() {
            const gender = document.getElementById('gender').value;
            const age = parseInt(document.getElementById('age').value);
            const height = parseInt(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const activity = document.getElementById('activity').value;
            const goal = document.getElementById('goal').value;
            
            // Calculate BMR (Mifflin-St Jeor)
            let bmr;
            if (gender === 'homme') {
                bmr = 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                bmr = 10 * weight + 6.25 * height - 5 * age - 161;
            }
            
            // Activity multipliers
            const activityMultipliers = {
                sedentary: 1.2,
                light: 1.375,
                moderate: 1.55,
                active: 1.725,
                athlete: 1.9
            };
            
            let tdee = bmr * activityMultipliers[activity];
            
            // Goal adjustments
            const goalAdjustments = {
                'cut': -500,
                'cut-moderate': -250,
                'maintenance': 0,
                'bulk-moderate': 250,
                'bulk': 500
            };
            
            const targetCalories = Math.round(tdee + goalAdjustments[goal]);
            
            // Calculate macros
            const proteinCalories = (targetCalories * appState.user.proteinPercent) / 100;
            const fatCalories = (targetCalories * appState.user.fatPercent) / 100;
            const carbCalories = (targetCalories * appState.user.carbPercent) / 100;
            
            appState.nutrition.targetCalories = targetCalories;
            appState.nutrition.targetProteins = Math.round(proteinCalories / 4);
            appState.nutrition.targetFats = Math.round(fatCalories / 9);
            appState.nutrition.targetCarbs = Math.round(carbCalories / 4);
            
            // Update UI
            document.getElementById('metabolicRate').textContent = Math.round(tdee);
            updateDashboard();
            saveProfile();
            
            showSuccess(`Besoins calcul√©s: ${targetCalories} kcal/jour`);
        }

        function saveProfile() {
            // Update state from form
            appState.user.gender = document.getElementById('gender').value;
            appState.user.age = parseInt(document.getElementById('age').value);
            appState.user.height = parseInt(document.getElementById('height').value);
            appState.user.weight = parseFloat(document.getElementById('weight').value);
            appState.user.activity = document.getElementById('activity').value;
            appState.user.goal = document.getElementById('goal').value;
            
            saveToCloud();
            showSuccess('Profil sauvegard√© !');
        }

        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Check if OpenAI API key is set
            const apiKey = appState.settings.apiKeys.openai;
            if (!apiKey) {
                addChatMessage("Pour utiliser le chat IA, veuillez d'abord configurer votre cl√© API OpenAI dans les param√®tres.", 'ai');
                return;
            }
            
            // Simulate AI response for now
            setTimeout(() => {
                const responses = [
                    "D'apr√®s votre profil, je recommande d'augmenter votre apport en prot√©ines √† 2.2g par kg de poids corporel pour optimiser la perte de gras tout en pr√©servant votre masse musculaire.",
                    "Pour atteindre votre objectif de perte de poids, maintenez un d√©ficit calorique de 500 kcal/jour. Cela devrait vous permettre de perdre environ 0.5kg par semaine de fa√ßon saine.",
                    "N'oubliez pas de boire au moins 2L d'eau par jour. L'hydratation est cruciale pour le m√©tabolisme et la r√©cup√©ration musculaire.",
                    "Je vous conseille de r√©partir vos prot√©ines sur 4-5 repas dans la journ√©e pour une meilleure synth√®se prot√©ique.",
                    "Privil√©giez les glucides complexes (avoine, riz complet, patate douce) autour de vos entra√Ænements pour optimiser vos performances."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addChatMessage(randomResponse, 'ai');
            }, 1000);
        }

        function addChatMessage(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const icon = sender === 'ai' ? 'ü§ñ' : 'üë§';
            messageDiv.innerHTML = `
                <p><strong>${icon} ${sender === 'ai' ? 'Coach IA' : 'Vous'}</strong></p>
                <p>${message}</p>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Add enter key support for chat
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });

        // Recipe generation
        function generateRecipe() {
            const apiKey = appState.settings.apiKeys.openai;
            if (!apiKey) {
                showSuccess('Veuillez configurer votre cl√© API OpenAI dans les param√®tres');
                return;
            }
            showSuccess('G√©n√©ration de recette en cours...');
        }

        // Week planning
        function generateWeekPlan() {
            const days = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
            const meals = ['Petit-d√©jeuner', 'D√©jeuner', 'Collation', 'D√Æner'];
            
            let planHTML = '<h3 style="margin-bottom: 20px;">üìÖ Votre planning de la semaine</h3>';
            planHTML += '<div style="display: grid; gap: 20px;">';
            
            days.forEach(day => {
                planHTML += `
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <h4 style="color: #7c3aed; margin-bottom: 15px;">${day}</h4>
                        <div style="display: grid; gap: 10px;">
                `;
                
                meals.forEach(meal => {
                    planHTML += `
                        <div style="background: #f5f5f5; padding: 10px; border-radius: 8px;">
                            <strong>${meal}:</strong> 
                            <span style="color: #666;">G√©n√©r√© par IA selon vos pr√©f√©rences</span>
                        </div>
                    `;
                });
                
                planHTML += `
                        </div>
                    </div>
                `;
            });
            
            planHTML += '</div>';
            
            document.getElementById('weekPlan').innerHTML = planHTML;
            document.getElementById('weekPlan').style.display = 'block';
            
            appState.weekPlan = { generated: new Date().toISOString() };
            saveToCloud();
            showSuccess('Planning de la semaine g√©n√©r√© !');
        }

        // Food management
        function showAddFoodModal() {
            document.getElementById('addFoodModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function addCustomFood() {
            const name = document.getElementById('foodName').value;
            const quantity = parseFloat(document.getElementById('foodQuantity').value);
            const calories = parseFloat(document.getElementById('foodCalories').value);
            const proteins = parseFloat(document.getElementById('foodProteins').value);
            const carbs = parseFloat(document.getElementById('foodCarbs').value);
            const fats = parseFloat(document.getElementById('foodFats').value);
            
            if (!name || !quantity) {
                alert('Veuillez remplir tous les champs requis');
                return;
            }
            
            // Add to daily totals
            appState.nutrition.calories += calories;
            appState.nutrition.proteins += proteins;
            appState.nutrition.carbs += carbs;
            appState.nutrition.fats += fats;
            
            // Add to meals list
            appState.meals.push({
                name,
                quantity,
                calories,
                proteins,
                carbs,
                fats,
                time: new Date().toLocaleTimeString()
            });
            
            updateDashboard();
            closeModal('addFoodModal');
            saveToCloud();
            showSuccess(`${name} ajout√© !`);
            
            // Clear form
            document.getElementById('foodName').value = '';
            document.getElementById('foodQuantity').value = '100';
            document.getElementById('foodCalories').value = '';
            document.getElementById('foodProteins').value = '';
            document.getElementById('foodCarbs').value = '';
            document.getElementById('foodFats').value = '';
        }

        // Analytics functions
        function addWeightEntry() {
            const weight = parseFloat(document.getElementById('newWeight').value);
            if (!weight) return;
            
            appState.weightHistory.push({
                date: new Date().toISOString(),
                weight: weight
            });
            
            appState.user.weight = weight;
            document.getElementById('newWeight').value = '';
            
            saveToCloud();
            updateWeightChart();
            showSuccess('Poids enregistr√© !');
        }

        function initializeWeightChart() {
            const canvas = document.getElementById('weightChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            // Simple line chart placeholder
            ctx.strokeStyle = '#7c3aed';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, 100);
            ctx.lineTo(400, 80);
            ctx.stroke();
        }

        function updateWeightChart() {
            initializeWeightChart();
        }

        function updateGlassSize() {
            const newSize = parseInt(document.getElementById('glassSize').value);
            appState.settings.glassSize = newSize;
            appState.hydration.glassVolume = newSize;
            
            // Recalculate target glasses based on daily goal
            appState.hydration.targetGlasses = Math.ceil(appState.hydration.dailyGoal / newSize);
            
            initializeHydration();
            updateDashboard();
            saveToCloud();
            showSuccess('Taille des verres mise √† jour');
        }

        function updateHydrationGoal() {
            const newGoal = parseInt(document.getElementById('hydrationGoal').value);
            appState.settings.hydrationGoal = newGoal;
            appState.hydration.dailyGoal = newGoal;
            
            // Recalculate target glasses
            appState.hydration.targetGlasses = Math.ceil(newGoal / appState.hydration.glassVolume);
            
            initializeHydration();
            updateDashboard();
            saveToCloud();
            showSuccess('Objectif d\'hydratation mis √† jour');
        }

        function updateDataSize() {
            const dataString = JSON.stringify(appState);
            const sizeInBytes = new Blob([dataString]).size;
            const sizeInKB = (sizeInBytes / 1024).toFixed(2);
            
            const dataSizeElement = document.getElementById('dataSize');
            if (dataSizeElement) {
                dataSizeElement.textContent = `${sizeInKB} KB`;
            }
        }

        // Export/Import functions
        function exportData() {
            const dataStr = JSON.stringify(appState, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `nutrisync-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showSuccess('Donn√©es export√©es !');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        appState = {
                            ...importedData,
                            syncCode: appState.syncCode // Keep current sync code
                        };
                        saveToCloud();
                        location.reload();
                    } catch (error) {
                        alert('Erreur lors de l\'importation des donn√©es');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetData() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser toutes vos donn√©es ?')) {
                // Keep sync code
                const currentSyncCode = appState.syncCode;
                
                // Reset to default state
                localStorage.removeItem('nutritionAppState');
                localStorage.removeItem('nutritionAppSettings');
                
                // Generate new sync code
                appState.syncCode = generateSyncCode();
                localStorage.setItem('nutriSyncCode', appState.syncCode);
                
                saveToCloud();
                location.reload();
            }
        }

        function generateWeeklyReport() {
            showSuccess('G√©n√©ration du rapport hebdomadaire...');
            setTimeout(() => {
                showSuccess('Rapport hebdomadaire g√©n√©r√© !');
            }, 1500);
        }

        function generateMonthlyReport() {
            showSuccess('G√©n√©ration du rapport mensuel...');
            setTimeout(() => {
                showSuccess('Rapport mensuel g√©n√©r√© !');
            }, 1500);
        }

        function exportCSV() {
            let csv = 'Date,Calories,Prot√©ines,Glucides,Lipides,Poids\n';
            
            // Add sample data
            const today = new Date().toLocaleDateString();
            csv += `${today},${appState.nutrition.calories},${appState.nutrition.proteins},${appState.nutrition.carbs},${appState.nutrition.fats},${appState.user.weight}\n`;
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `nutrisync-export-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showSuccess('Export CSV termin√© !');
        }

        function generatePDF() {
            showSuccess('G√©n√©ration du PDF en cours...');
            setTimeout(() => {
                showSuccess('PDF g√©n√©r√© ! (N√©cessite une biblioth√®que PDF)');
            }, 2000);
        }

        // Settings
        function saveSettings() {
            const settings = {
                openai: document.getElementById('openaiKey').value,
                googleVision: document.getElementById('googleVisionKey').value,
                stability: document.getElementById('stabilityKey').value,
                googleFit: document.getElementById('googleFitKey').value,
                fatSecret: document.getElementById('fatSecretKey').value,
                edamam: document.getElementById('edamamKey').value
            };
            
            // Store API keys locally only
            appState.settings.apiKeys = settings;
            localStorage.setItem('nutritionAppSettings', JSON.stringify(settings));
            showSuccess('Param√®tres sauvegard√©s !');
        }

        // Barcode Scanner Functions
        function startBarcodeScanner() {
            showSuccess('Scanner de code-barres activ√© (n√©cessite API cam√©ra)');
        }

        function searchByBarcode() {
            const barcode = document.getElementById('barcodeInput').value;
            if (!barcode) {
                alert('Veuillez entrer un code-barres');
                return;
            }
            
            showSuccess('Recherche du produit...');
            setTimeout(() => {
                const mockProduct = {
                    name: 'Yaourt Nature Bio',
                    brand: 'Danone',
                    calories: 65,
                    proteins: 4.5,
                    carbs: 5.2,
                    fats: 3.5,
                    serving: 125
                };
                
                displayBarcodeResult(mockProduct);
            }, 1500);
        }

        function displayBarcodeResult(product) {
            const infoDiv = document.getElementById('barcodeProductInfo');
            infoDiv.innerHTML = `
                <h4>${product.name}</h4>
                <p style="color: #666; margin-bottom: 15px;">${product.brand}</p>
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px;">
                    <p><strong>Pour ${product.serving}g :</strong></p>
                    <p>Calories: ${product.calories} kcal</p>
                    <p>Prot√©ines: ${product.proteins}g</p>
                    <p>Glucides: ${product.carbs}g</p>
                    <p>Lipides: ${product.fats}g</p>
                </div>
            `;
            
            document.getElementById('barcodeResultModal').classList.add('active');
        }

        function addBarcodeProduct() {
            showSuccess('Produit ajout√© !');
            closeModal('barcodeResultModal');
        }

        // Smart Suggestions
        function generateSmartSuggestions() {
            const remainingProteins = appState.nutrition.targetProteins - appState.nutrition.proteins;
            const remainingCalories = appState.nutrition.targetCalories - appState.nutrition.calories;
            
            const suggestions = [
                {
                    name: 'Blanc de poulet grill√©',
                    quantity: '150g',
                    proteins: 46,
                    calories: 247,
                    icon: 'üçó'
                },
                {
                    name: 'Shake prot√©in√©',
                    quantity: '1 scoop',
                    proteins: 25,
                    calories: 120,
                    icon: 'ü•§'
                },
                {
                    name: 'Fromage blanc 0%',
                    quantity: '200g',
                    proteins: 16,
                    calories: 130,
                    icon: 'ü•õ'
                },
                {
                    name: 'Thon au naturel',
                    quantity: '100g',
                    proteins: 26,
                    calories: 116,
                    icon: 'üêü'
                }
            ];
            
            const suggestionsDiv = document.getElementById('smartSuggestions');
            if (!suggestionsDiv) return;
            
            suggestionsDiv.innerHTML = suggestions.map(food => `
                <div class="suggestion-card" onclick="addSuggestedFood('${food.name}', ${food.calories}, ${food.proteins})">
                    <span style="font-size: 24px;">${food.icon}</span>
                    <div>
                        <strong>${food.name}</strong>
                        <p style="color: #666; font-size: 14px; margin: 0;">${food.quantity}</p>
                    </div>
                    <div class="macro-info">
                        <p style="margin: 0;">${food.proteins}g prot√©ines</p>
                        <p style="margin: 0;">${food.calories} kcal</p>
                    </div>
                </div>
            `).join('');
        }

        function addSuggestedFood(name, calories, proteins) {
            appState.nutrition.calories += calories;
            appState.nutrition.proteins += proteins;
            updateDashboard();
            saveToCloud();
            showSuccess(`${name} ajout√© !`);
            generateSmartSuggestions();
        }

        // Recipe Management
        function showCreateRecipeModal() {
            document.getElementById('createRecipeModal').classList.add('active');
        }

        function saveRecipe() {
            const name = document.getElementById('recipeName').value;
            const ingredients = document.getElementById('recipeIngredients').value;
            const mealType = document.getElementById('recipeMealType').value;
            
            if (!name || !ingredients) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            const recipe = {
                id: Date.now(),
                name,
                ingredients: ingredients.split('\n').filter(i => i.trim()),
                mealType,
                created: new Date().toISOString()
            };
            
            appState.recipes.push(recipe);
            saveToCloud();
            updateFavoriteRecipes();
            closeModal('createRecipeModal');
            showSuccess('Recette sauvegard√©e !');
            
            document.getElementById('recipeName').value = '';
            document.getElementById('recipeIngredients').value = '';
        }

        function updateFavoriteRecipes() {
            const recipesDiv = document.getElementById('favoriteRecipes');
            if (!recipesDiv) return;
            
            if (appState.recipes.length === 0) {
                recipesDiv.innerHTML = '<p style="color: #666;">Aucune recette favorite pour le moment</p>';
                return;
            }
            
            recipesDiv.innerHTML = appState.recipes.map(recipe => `
                <div class="recipe-card" onclick="useRecipe(${recipe.id})">
                    <div>
                        <strong>${recipe.name}</strong>
                        <p style="color: #666; font-size: 14px; margin: 0;">${recipe.ingredients.length} ingr√©dients</p>
                    </div>
                    <button class="btn" style="background: #ff6f00; color: white; padding: 5px 15px;" onclick="event.stopPropagation(); deleteRecipe(${recipe.id})">
                        üóëÔ∏è
                    </button>
                </div>
            `).join('');
        }

        function useRecipe(recipeId) {
            const recipe = appState.recipes.find(r => r.id === recipeId);
            if (recipe) {
                showSuccess(`Recette "${recipe.name}" ajout√©e au repas !`);
            }
        }

        function deleteRecipe(recipeId) {
            if (confirm('Supprimer cette recette ?')) {
                appState.recipes = appState.recipes.filter(r => r.id !== recipeId);
                saveToCloud();
                updateFavoriteRecipes();
                showSuccess('Recette supprim√©e');
            }
        }

        // Intermittent Fasting
        let fastingInterval = null;

        function startFasting(hours) {
            appState.fasting.targetHours = hours;
            appState.fasting.isActive = true;
            appState.fasting.startTime = new Date().getTime();
            saveToCloud();
            updateFastingUI();
            showSuccess(`Je√ªne ${hours}:${24-hours} commenc√© !`);
        }

        function customFasting() {
            const hours = prompt('Dur√©e du je√ªne en heures (ex: 16)');
            if (hours && !isNaN(hours)) {
                startFasting(parseInt(hours));
            }
        }

        function toggleFasting() {
            if (appState.fasting.isActive) {
                return;
            }
            startFasting(appState.fasting.targetHours || 16);
        }

        function endFasting() {
            if (!appState.fasting.isActive) return;
            
            const duration = (new Date().getTime() - appState.fasting.startTime) / 1000 / 60 / 60;
            appState.fasting.isActive = false;
            appState.fasting.startTime = null;
            saveToCloud();
            updateFastingUI();
            showSuccess(`Je√ªne termin√© apr√®s ${duration.toFixed(1)} heures !`);
        }

        function updateFastingUI() {
            const timerElement = document.getElementById('fastingTimer');
            const stateText = document.getElementById('fastingStateText');
            const toggleText = document.getElementById('fastingToggleText');
            
            if (!timerElement || !stateText || !toggleText || !appState.fasting) {
                return;
            }
            
            if (appState.fasting.isActive) {
                if (fastingInterval) clearInterval(fastingInterval);
                
                fastingInterval = setInterval(() => {
                    const elapsed = new Date().getTime() - appState.fasting.startTime;
                    const hours = Math.floor(elapsed / 1000 / 60 / 60);
                    const minutes = Math.floor((elapsed / 1000 / 60) % 60);
                    const seconds = Math.floor((elapsed / 1000) % 60);
                    
                    timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    const progress = (hours + minutes/60) / appState.fasting.targetHours * 100;
                    stateText.textContent = `Je√ªne en cours - ${Math.min(100, Math.round(progress))}% compl√©t√©`;
                }, 1000);
                
                toggleText.textContent = 'Je√ªne en cours';
            } else {
                if (fastingInterval) clearInterval(fastingInterval);
                timerElement.textContent = '00:00:00';
                stateText.textContent = 'Pas de je√ªne en cours';
                toggleText.textContent = 'Commencer le je√ªne';
            }
        }

        // Micronutrients Charts
        function updateMicronutrientCharts() {
            const vitaminsCanvas = document.getElementById('vitaminsChart');
            const mineralsCanvas = document.getElementById('mineralsChart');
            
            if (vitaminsCanvas && mineralsCanvas) {
                drawRadarChart(vitaminsCanvas, 'Vitamines', ['A', 'C', 'D', 'E', 'B12'], [60, 80, 40, 70, 90]);
                drawRadarChart(mineralsCanvas, 'Min√©raux', ['Fer', 'Calcium', 'Zinc', 'Magn√©sium'], [75, 50, 85, 65]);
            }
        }

        function drawRadarChart(canvas, title, labels, data) {
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 40;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = '16px Arial';
            ctx.fillStyle = '#333';
            ctx.textAlign = 'center';
            ctx.fillText(title, centerX, 30);
            
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            for (let i = 1; i <= 5; i++) {
                ctx.beginPath();
                for (let j = 0; j < labels.length; j++) {
                    const angle = (Math.PI * 2 * j) / labels.length - Math.PI / 2;
                    const x = centerX + Math.cos(angle) * (radius * i / 5);
                    const y = centerY + Math.sin(angle) * (radius * i / 5);
                    if (j === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.stroke();
            }
            
            ctx.fillStyle = 'rgba(124, 58, 237, 0.3)';
            ctx.strokeStyle = '#7c3aed';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < data.length; i++) {
                const angle = (Math.PI * 2 * i) / data.length - Math.PI / 2;
                const value = data[i] / 100 * radius;
                const x = centerX + Math.cos(angle) * value;
                const y = centerY + Math.sin(angle) * value;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            for (let i = 0; i < labels.length; i++) {
                const angle = (Math.PI * 2 * i) / labels.length - Math.PI / 2;
                const x = centerX + Math.cos(angle) * (radius + 20);
                const y = centerY + Math.sin(angle) * (radius + 20);
                ctx.textAlign = 'center';
                ctx.fillText(labels[i], x, y);
            }
        }

        // AI Progress Photos
        function uploadProgressPhoto(type) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        appState.progressPhotos[type] = e.target.result;
                        saveToCloud();
                        showSuccess(`Photo ${type === 'before' ? 'avant' : 'apr√®s'} ajout√©e !`);
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function analyzeProgress() {
            if (!appState.progressPhotos.before || !appState.progressPhotos.after) {
                alert('Veuillez d\'abord ajouter les deux photos');
                return;
            }
            
            showSuccess('Analyse en cours...');
            setTimeout(() => {
                const results = {
                    muscleGain: '+2.3kg',
                    fatLoss: '-4.1kg',
                    bodyFatChange: '-3.2%',
                    visibleChanges: [
                        'D√©finition abdominale am√©lior√©e',
                        'Augmentation du volume des √©paules',
                        'R√©duction du tour de taille'
                    ]
                };
                
                alert(`R√©sultats de l'analyse IA:\n\nGain musculaire: ${results.muscleGain}\nPerte de graisse: ${results.fatLoss}\nChangement % graisse: ${results.bodyFatChange}\n\nChangements visibles:\n${results.visibleChanges.join('\n')}`);
            }, 2000);
        }

        // Voice Coach
        let voiceCoachActive = false;
        let speechSynthesis = window.speechSynthesis;

        function toggleVoiceCoach() {
            voiceCoachActive = !voiceCoachActive;
            appState.voiceCoach.isActive = voiceCoachActive;
            
            const toggle = document.getElementById('voiceCoachToggle');
            const status = document.getElementById('voiceCoachStatus');
            
            if (voiceCoachActive) {
                toggle.textContent = 'üîá D√©sactiver le coach vocal';
                status.style.display = 'block';
                speakCoachMessage('Coach vocal activ√©. Je suis l√† pour vous guider dans votre parcours nutritionnel.');
            } else {
                toggle.textContent = 'üîä Activer le coach vocal';
                status.style.display = 'none';
                speechSynthesis.cancel();
            }
            
            saveToCloud();
        }

        function speakCoachMessage(message) {
            if (!voiceCoachActive || !speechSynthesis) return;
            
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = document.getElementById('voiceLanguage').value;
            utterance.rate = 0.9;
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }

        // Food photo analysis
        function analyzeFood(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showSuccess('Analyse de la photo en cours...');
            
            setTimeout(() => {
                const mockResults = [
                    { name: 'Riz blanc', quantity: '150g', calories: 195, proteins: 4.3, carbs: 42, fats: 0.6 },
                    { name: 'Poulet grill√©', quantity: '120g', calories: 198, proteins: 37, carbs: 0, fats: 4.3 },
                    { name: 'Brocoli', quantity: '80g', calories: 27, proteins: 2.3, carbs: 5.6, fats: 0.3 }
                ];
                
                let resultHTML = '<h4>Aliments d√©tect√©s:</h4>';
                mockResults.forEach(food => {
                    resultHTML += `
                        <div style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 8px;">
                            <strong>${food.name}</strong> (${food.quantity})
                            <br>Cal: ${food.calories} | P: ${food.proteins}g | G: ${food.carbs}g | L: ${food.fats}g
                            <button class="btn btn-success" style="float: right; padding: 5px 15px;" onclick="addDetectedFood('${food.name}', ${food.calories}, ${food.proteins}, ${food.carbs}, ${food.fats})">
                                Ajouter
                            </button>
                        </div>
                    `;
                });
                
                const resultDiv = document.createElement('div');
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 9999; max-width: 90%; max-height: 80vh; overflow-y: auto;';
                
                const closeBtn = document.createElement('button');
                closeBtn.textContent = 'Fermer';
                closeBtn.className = 'btn btn-primary';
                closeBtn.style.marginTop = '20px';
                closeBtn.onclick = () => document.body.removeChild(resultDiv);
                
                resultDiv.appendChild(closeBtn);
                document.body.appendChild(resultDiv);
            }, 2000);
        }

        function addDetectedFood(name, calories, proteins, carbs, fats) {
            appState.nutrition.calories += calories;
            appState.nutrition.proteins += proteins;
            appState.nutrition.carbs += carbs;
            appState.nutrition.fats += fats;
            
            appState.meals.push({
                name,
                calories,
                proteins,
                carbs,
                fats,
                time: new Date().toLocaleTimeString()
            });
            
            updateDashboard();
            saveToCloud();
            showSuccess(`${name} ajout√© !`);
        }

        // Utility functions
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = '‚úì ' + message;
            successDiv.classList.add('show');
            
            setTimeout(() => {
                successDiv.classList.remove('show');
            }, 3000);
        }

        function saveToLocalStorage() {
            localStorage.setItem('nutritionAppState', JSON.stringify(appState));
            updateDataSize();
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('nutritionAppState');
            if (saved) {
                const savedState = JSON.parse(saved);
                
                // Merge with default state to ensure all properties exist
                appState = {
                    ...appState,
                    ...savedState,
                    settings: {
                        ...appState.settings,
                        ...(savedState.settings || {})
                    },
                    fasting: {
                        ...appState.fasting,
                        ...(savedState.fasting || {})
                    },
                    voiceCoach: {
                        ...appState.voiceCoach,
                        ...(savedState.voiceCoach || {})
                    },
                    progressPhotos: {
                        ...appState.progressPhotos,
                        ...(savedState.progressPhotos || {})
                    },
                    micronutrients: {
                        ...appState.micronutrients,
                        ...(savedState.micronutrients || {})
                    }
                };
                
                // Ensure arrays exist
                appState.recipes = savedState.recipes || [];
                appState.meals = savedState.meals || [];
                appState.weightHistory = savedState.weightHistory || [];
                
                updateAllUI();
            }
            
            // Load settings
            const savedSettings = localStorage.getItem('nutritionAppSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                appState.settings.apiKeys = settings;
                
                // Update form fields
                if (document.getElementById('openaiKey')) {
                    document.getElementById('openaiKey').value = settings.openai || '';
                    document.getElementById('googleVisionKey').value = settings.googleVision || '';
                    document.getElementById('stabilityKey').value = settings.stability || '';
                    document.getElementById('googleFitKey').value = settings.googleFit || '';
                    document.getElementById('fatSecretKey').value = settings.fatSecret || '';
                    document.getElementById('edamamKey').value = settings.edamam || '';
                }
            }
        }

        function updateAllUI() {
            updateDashboard();
            initializeHydration();
            
            // Update profile form
            if (document.getElementById('gender')) {
                document.getElementById('gender').value = appState.user.gender;
                document.getElementById('age').value = appState.user.age;
                document.getElementById('height').value = appState.user.height;
                document.getElementById('weight').value = appState.user.weight;
                document.getElementById('activity').value = appState.user.activity;
                document.getElementById('goal').value = appState.user.goal;
                document.getElementById('proteinSlider').value = appState.user.proteinPercent;
                document.getElementById('fatSlider').value = appState.user.fatPercent;
                updateMacros();
            }
            
            // Update settings
            if (document.getElementById('glassSize')) {
                document.getElementById('glassSize').value = appState.settings.glassSize || 25;
            }
            if (document.getElementById('hydrationGoal')) {
                document.getElementById('hydrationGoal').value = appState.settings.hydrationGoal || 200;
            }
            
            // Update other UI elements
            updateFavoriteRecipes();
            generateSmartSuggestions();
        }

        // Initialize new features on load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize fasting UI
            if (appState.fasting) {
                updateFastingUI();
            }
            
            // Initialize micronutrient charts
            setTimeout(() => {
                updateMicronutrientCharts();
            }, 500);
            
            // Initialize recipes
            if (appState.recipes) {
                updateFavoriteRecipes();
            }
            
            // Generate initial suggestions
            const suggestionsDiv = document.getElementById('smartSuggestions');
            if (suggestionsDiv) {
                generateSmartSuggestions();
            }
            
            // Check for voice coach support
            if (!('speechSynthesis' in window)) {
                console.log('Voice synthesis not supported');
            }
        });

        // Click outside modal to close
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        };

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            if (fastingInterval) {
                clearInterval(fastingInterval);
            }
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriSync - Synchronise ta nutrition avec tes objectifs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* Header */
        .header {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-subtitle {
            font-size: 14px;
            color: #666;
        }

        .sync-badge {
            background: #d4f8d4;
            color: #2e7d2e;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sync-badge:hover {
            background: #c0f0c0;
            transform: scale(1.05);
        }

        .sync-badge.syncing {
            background: #fff3cd;
            color: #856404;
        }

        .sync-badge.error {
            background: #f8d7da;
            color: #721c24;
        }

        /* Navigation */
        .nav-bar {
            background: #7c3aed;
            padding: 0;
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .nav-bar::-webkit-scrollbar {
            display: none;
        }

        .nav-item {
            color: white;
            padding: 15px 25px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-item.active {
            border-bottom-color: white;
            background: rgba(255,255,255,0.1);
        }

        /* Main Content */
        .content {
            padding: 20px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 25px;
        }

        /* Sync Info Box */
        .sync-info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .sync-info-box.show {
            display: block;
            animation: slideIn 0.3s;
        }

        .sync-code-container {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sync-code {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
            flex: 1;
        }

        .copy-btn {
            background: white;
            color: #7c3aed;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            transform: scale(1.05);
        }

        .copy-btn.copied {
            background: #4caf50;
            color: white;
        }

        /* Dashboard Cards */
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card.active {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .stat-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            font-size: 14px;
            color: #666;
        }

        /* AI Prediction Box */
        .ai-prediction {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .ai-prediction h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .ai-prediction .tip {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        /* Hydration Tracker */
        .hydration-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .hydration-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .hydration-glasses {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .glass {
            width: 40px;
            height: 50px;
            background: #e3f2fd;
            border-radius: 5px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .glass.filled {
            background: #2196f3;
        }

        .glass:hover {
            transform: scale(1.1);
        }

        .reset-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #45a049;
        }

        /* Nutrition Dashboard */
        .nutrition-dashboard {
            background: #7c3aed;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .nutrition-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            text-align: center;
            margin-bottom: 20px;
        }

        .nutrition-stat h2 {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .nutrition-stat p {
            font-size: 14px;
            opacity: 0.8;
        }

        .progress-bars {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Action Cards */
        .action-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .action-card.green {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .action-card.blue {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
        }

        .action-card.pink {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
        }

        .action-card-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .action-card h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .action-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Forms and Inputs */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .slider-container {
            margin: 20px 0;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2196f3;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #7c3aed;
            color: white;
        }

        .btn-primary:hover {
            background: #6d28d9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: #333;
        }

        /* AI Coach Chat */
        .chat-container {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .chat-message {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .chat-message.ai {
            background: #e3f2fd;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
        }

        .chat-send-btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .chat-send-btn:hover {
            background: #6d28d9;
        }

        /* Recipe Generator */
        .recipe-form {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .macro-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .restriction-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .restriction-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .restriction-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Fasting timer */
        .fasting-ring {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }
        
        .fasting-ring svg {
            transform: rotate(-90deg);
        }
        
        .fasting-ring circle {
            fill: none;
            stroke-width: 10;
        }
        
        .fasting-ring .background {
            stroke: rgba(255,255,255,0.2);
        }
        
        .fasting-ring .progress {
            stroke: white;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        /* Recipe card */
        .recipe-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .recipe-card:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        /* Voice coach animation */
        .voice-wave {
            display: flex;
            align-items: center;
            gap: 3px;
            margin-left: 10px;
        }
        
        .voice-wave span {
            display: inline-block;
            width: 3px;
            height: 20px;
            background: white;
            border-radius: 3px;
            animation: wave 1s ease-in-out infinite;
        }
        
        .voice-wave span:nth-child(2) {
            animation-delay: 0.1s;
        }
        
        .voice-wave span:nth-child(3) {
            animation-delay: 0.2s;
        }
        
        .voice-wave span:nth-child(4) {
            animation-delay: 0.3s;
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }

        /* Progress photo */
        .progress-photo {
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }
        
        .progress-photo .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .progress-photo:hover .overlay {
            opacity: 1;
        }

        /* Suggestion card */
        .suggestion-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .suggestion-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .suggestion-card .macro-info {
            margin-left: auto;
            text-align: right;
            font-size: 14px;
            color: #666;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-bar {
                overflow-x: auto;
            }
            
            .nutrition-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .stat-cards {
                grid-template-columns: 1fr;
            }
            
            .action-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden sections */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Food search */
        .meal-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .meal-btn {
            padding: 15px 25px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }

        .meal-btn.active {
            border-color: #7c3aed;
            background: #f3f0ff;
        }

        .meal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
        }

        .scan-btn {
            background: #ff9800;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .scan-btn:hover {
            background: #f57c00;
        }

        /* Photo analysis */
        .photo-analysis {
            background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .photo-upload-area {
            border: 3px dashed rgba(255,255,255,0.5);
            border-radius: 12px;
            padding: 40px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .photo-upload-area:hover {
            border-color: white;
            background: rgba(255,255,255,0.1);
        }

        /* Alert box */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
        }

        /* Profile section */
        .profile-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .macro-recommendation {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .macro-recommendation h4 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            color: #92400e;
        }

        .macro-recommendation ul {
            list-style: none;
            padding-left: 0;
        }

        .macro-recommendation li {
            padding: 5px 0;
            color: #78350f;
        }

        /* Habits analysis */
        .habits-analysis {
            background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .habits-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .habit-stat {
            text-align: center;
        }

        .habit-stat h3 {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .habit-stat p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success message */
        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            animation: slideIn 0.3s;
            z-index: 2000;
        }

        .success-message.show {
            display: block;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Quick protein calculator */
        .quick-calc {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .quick-calc h4 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .calc-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .calc-result {
            background: #c8e6c9;
            padding: 10px 15px;
            border-radius: 8px;
            color: #1b5e20;
            font-weight: 500;
        }

        /* Sync Code Modal */
        #syncModal {
            display: none;
        }

        .sync-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sync-input-group {
            display: flex;
            gap: 10px;
        }

        .sync-input-group input {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">ü•ó</div>
            <div>
                <h1>NutriSync</h1>
                <div class="header-subtitle">Synchronise ta nutrition avec tes objectifs</div>
            </div>
            <div class="sync-badge" id="syncBadge" onclick="toggleSyncInfo()">
                ‚úì <span id="syncStatus">Donn√©es synchronis√©es</span>
            </div>
        </div>

        <!-- Sync Info Box -->
        <div class="sync-info-box" id="syncInfoBox">
            <h3>üîÑ Synchronisation NutriSync</h3>
            <p>Utilisez ce code sur n'importe quel appareil pour retrouver vos donn√©es :</p>
            <div class="sync-code-container">
                <div class="sync-code" id="syncCode">NUTRI-XXXXX</div>
                <button class="copy-btn" onclick="copySyncCode()">üìã Copier</button>
            </div>
            <p style="font-size: 14px; opacity: 0.9;">
                üí° Gardez ce code secret ! Il donne acc√®s √† toutes vos donn√©es.
            </p>
            <button class="btn" style="background: rgba(255,255,255,0.2); color: white; margin-top: 10px;" onclick="showSyncModal()">
                üîó J'ai d√©j√† un code
            </button>
        </div>

        <!-- Navigation -->
        <nav class="nav-bar">
            <a href="#dashboard" class="nav-item active" onclick="showPage('dashboard')">
                üè† Dashboard
            </a>
            <a href="#profile" class="nav-item" onclick="showPage('profile')">
                üë§ Profil
            </a>
            <a href="#foods" class="nav-item" onclick="showPage('foods')">
                üçΩÔ∏è Aliments
            </a>
            <a href="#analytics" class="nav-item" onclick="showPage('analytics')">
                üìä Analytics
            </a>
            <a href="#ai-coach" class="nav-item" onclick="showPage('ai-coach')">
                üí¨ IA Coach
            </a>
            <a href="#planning" class="nav-item" onclick="showPage('planning')">
                üìÖ Planning
            </a>
            <a href="#courses" class="nav-item" onclick="showPage('courses')">
                üõí Courses
            </a>
            <a href="#coaching" class="nav-item" onclick="showPage('coaching')">
                üéØ Coaching
            </a>
            <a href="#cloud" class="nav-item" onclick="showPage('cloud')">
                ‚òÅÔ∏è Cloud
            </a>
            <a href="#settings" class="nav-item" onclick="showPage('settings')">
                ‚öôÔ∏è Param√®tres
            </a>
        </nav>

        <!-- Content -->
        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page-section active">
                <h2 class="page-title">Dashboard - <span id="currentDate"></span></h2>

                <!-- Stat Cards -->
                <div class="stat-cards">
                    <div class="stat-card active">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-title">Cut</div>
                        <div class="stat-subtitle">Perte de gras</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí™</div>
                        <div class="stat-title">Bulk</div>
                        <div class="stat-subtitle">Prise de masse</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚öñÔ∏è</div>
                        <div class="stat-title">Maintenance</div>
                        <div class="stat-subtitle">Maintien</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-title">Recomp</div>
                        <div class="stat-subtitle">Recomposition</div>
                    </div>
                </div>

                <!-- AI Prediction -->
                <div class="ai-prediction">
                    <h3>‚ú® Pr√©diction IA bas√©e sur vos donn√©es</h3>
                    <p>Avec vos habitudes actuelles, vous devriez atteindre votre objectif dans <strong>12 semaines</strong>.</p>
                    <div class="tip">
                        üí° <span><strong>Conseil du jour:</strong> Augmentez votre apport en prot√©ines de 10g pour optimiser la perte de gras tout en pr√©servant la masse musculaire.</span>
                    </div>
                </div>

                <!-- Hydration Tracker -->
                <div class="hydration-section">
                    <div class="hydration-header">
                        <h3>üíß Hydratation (25cl/verre) :</h3>
                        <button class="reset-btn" onclick="resetHydration()">Reset</button>
                    </div>
                    <div class="hydration-glasses" id="hydrationGlasses">
                        <!-- Glasses will be generated by JavaScript -->
                    </div>
                    <p style="color: #666; font-size: 14px;">
                        <span id="hydrationStatus">0/8 verres = 0cl</span> / 200cl objectif<br>
                        Cliquez sur les verres pour suivre votre hydratation
                    </p>
                </div>

                <!-- Nutrition Dashboard -->
                <div class="nutrition-dashboard">
                    <h3 style="margin-bottom: 20px;">üçî Tableau de bord nutritionnel avanc√©</h3>
                    <div class="nutrition-stats">
                        <div class="nutrition-stat">
                            <h2 id="consumedCalories">0</h2>
                            <p>Consomm√©es</p>
                        </div>
                        <div class="nutrition-stat">
                            <h2 id="remainingCalories">1836</h2>
                            <p>Restantes</p>
                        </div>
                        <div class="nutrition-stat">
                            <h2 id="burnedCalories">206</h2>
                            <p>Br√ªl√©es</p>
                        </div>
                        <div class="nutrition-stat">
                            <h2 id="metabolicRate">2836</h2>
                            <p>M√©tabolisme</p>
                        </div>
                    </div>
                    <div class="progress-bars">
                        <div>
                            <div class="progress-item">
                                <span>Calories</span>
                                <span id="caloriesProgress">0 / 1836</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="caloriesBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="progress-item">
                                <span>Prot√©ines</span>
                                <span id="proteinsProgress">0g / 138g</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="proteinsBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="progress-item">
                                <span>Hydratation</span>
                                <span id="hydrationProgress">0cl / 200cl</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="hydrationBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Cards -->
                <div class="action-cards">
                    <div class="action-card green" onclick="showPage('planning')">
                        <div class="action-card-icon">üìÖ</div>
                        <h3>Planning Repas IA</h3>
                        <p>Semaine g√©n√©r√©e auto</p>
                    </div>
                    <div class="action-card blue" onclick="showPage('courses')">
                        <div class="action-card-icon">üõí</div>
                        <h3>Liste de Courses</h3>
                        <p>G√©n√©r√©e du planning</p>
                    </div>
                    <div class="action-card pink" onclick="showPage('ai-coach')">
                        <div class="action-card-icon">ü§ñ</div>
                        <h3>Coach IA Intensif</h3>
                        <p>Suivi quotidien</p>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="stat-cards">
                    <div class="stat-card" style="background: #e3f2fd;">
                        <h2 style="color: #2196f3; font-size: 36px; margin-bottom: 10px;">0</h2>
                        <p style="font-weight: 600;">Calories consomm√©es</p>
                        <p style="font-size: 14px; color: #666;">Objectif: 1836<br>Restant: 1836</p>
                    </div>
                    <div class="stat-card" style="background: #e3f2fd;">
                        <h2 style="color: #2196f3; font-size: 36px; margin-bottom: 10px;">0g</h2>
                        <p style="font-weight: 600;">Prot√©ines</p>
                        <p style="font-size: 14px; color: #666;">Objectif: 138g</p>
                    </div>
                </div>

                <!-- Micronutriments -->
                <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;">üìä Micronutriments d√©taill√©s</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #4caf50; margin-bottom: 5px;">Vitamine C</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0mg</p>
                            <p style="color: #666; font-size: 14px;">/ 90mg</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #ff5722; margin-bottom: 5px;">Fer</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0mg</p>
                            <p style="color: #666; font-size: 14px;">/ 18mg</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #2196f3; margin-bottom: 5px;">Calcium</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0mg</p>
                            <p style="color: #666; font-size: 14px;">/ 1000mg</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #9c27b0; margin-bottom: 5px;">Vitamine D</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0Œºg</p>
                            <p style="color: #666; font-size: 14px;">/ 20Œºg</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #e91e63; margin-bottom: 5px;">Fibres</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0g</p>
                            <p style="color: #666; font-size: 14px;">/ 25g</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #ff9800; margin-bottom: 5px;">B12</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0Œºg</p>
                            <p style="color: #666; font-size: 14px;">/ 2.4Œºg</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #3f51b5; margin-bottom: 5px;">Magn√©sium</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0mg</p>
                            <p style="color: #666; font-size: 14px;">/ 400mg</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #009688; margin-bottom: 5px;">Zinc</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">0mg</p>
                            <p style="color: #666; font-size: 14px;">/ 11mg</p>
                        </div>
                    </div>
                </div>

                <!-- Macronutrient Progress -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">Progression des macronutriments</h3>
                    <p style="color: #666; margin-bottom: 5px;">Prot√©ines (0%)</p>
                    <div class="progress-bar" style="margin-bottom: 20px;">
                        <div class="progress-fill" style="width: 0%; background: #4caf50;"></div>
                    </div>
                </div>

                <!-- Daily Distribution -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">R√©partition des macronutriments aujourd'hui</h3>
                    <div class="empty-state">
                        <p>Aucune donn√©e nutritionnelle aujourd'hui</p>
                    </div>
                </div>

                <!-- Today's Meals -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">Repas d'aujourd'hui</h3>
                    <div class="empty-state">
                        <p>Aucun repas ajout√© aujourd'hui</p>
                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="showPage('foods')">
                            Ajouter un repas
                        </button>
                    </div>
                </div>

                <!-- Intermittent Fasting Section -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;">‚è∞ Mode Je√ªne Intermittent</h3>
                    <div id="fastingStatus" style="text-align: center; margin: 20px 0;">
                        <h2 style="font-size: 48px; margin-bottom: 10px;" id="fastingTimer">00:00:00</h2>
                        <p id="fastingStateText">Pas de je√ªne en cours</p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="startFasting(16)">
                            16:8
                        </button>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="startFasting(18)">
                            18:6
                        </button>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="startFasting(20)">
                            20:4
                        </button>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="customFasting()">
                            Personnalis√©
                        </button>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="btn" style="background: #4caf50; color: white;" onclick="toggleFasting()">
                            <span id="fastingToggleText">Commencer le je√ªne</span>
                        </button>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="endFasting()">
                            Terminer le je√ªne
                        </button>
                    </div>
                </div>

                <!-- Advanced Micronutrients Tracking -->
                <div style="background: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">üìä Suivi Avanc√© des Micronutriments</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <canvas id="vitaminsChart" width="300" height="300"></canvas>
                        <canvas id="mineralsChart" width="300" height="300"></canvas>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="updateMicronutrientCharts()">
                            Actualiser les graphiques
                        </button>
                    </div>
                </div>

                <!-- AI Progress Photos -->
                <div style="background: #f3f0ff; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #7c3aed; margin-bottom: 20px;">üì∏ Analyse IA Photos Avant/Apr√®s</h3>
                    <p style="color: #666; margin-bottom: 20px;">Suivez vos progr√®s visuels avec l'analyse IA de composition corporelle</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <p style="font-weight: 600; margin-bottom: 10px;">Photo de r√©f√©rence</p>
                            <div style="background: #e0e0e0; height: 200px; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="uploadProgressPhoto('before')">
                                <p style="color: #666;">üì∑ Ajouter photo</p>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-weight: 600; margin-bottom: 10px;">Photo actuelle</p>
                            <div style="background: #e0e0e0; height: 200px; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="uploadProgressPhoto('after')">
                                <p style="color: #666;">üì∑ Ajouter photo</p>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="analyzeProgress()">
                        ü§ñ Analyser les changements
                    </button>
                </div>

                <!-- Voice Coach -->
                <div style="background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;">üéôÔ∏è Coach Vocal IA</h3>
                    <p style="margin-bottom: 20px;">Activez le coach vocal pour recevoir des conseils audio personnalis√©s</p>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <button class="btn" style="background: white; color: #0083b0;" onclick="toggleVoiceCoach()">
                            <span id="voiceCoachToggle">üîä Activer le coach vocal</span>
                        </button>
                        <select id="voiceLanguage" style="padding: 10px; border-radius: 8px; color: #333;">
                            <option value="fr-FR">Fran√ßais</option>
                            <option value="en-US">English</option>
                            <option value="es-ES">Espa√±ol</option>
                        </select>
                    </div>
                    <div id="voiceCoachStatus" style="margin-top: 15px; display: none;">
                        <p>üé§ Coach vocal actif</p>
                    </div>
                </div>

                <!-- ML Predictions -->
                <div style="background: #e1f5fe; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #0277bd; margin-bottom: 20px;">üß† Pr√©dictions Avanc√©es ML</h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #0288d1; margin-bottom: 10px;">D√©tection de plateau</h4>
                            <p style="color: #666;">Probabilit√© de plateau dans les 2 prochaines semaines : <strong>15%</strong></p>
                            <div style="background: #e0e0e0; height: 10px; border-radius: 5px; margin-top: 10px;">
                                <div style="background: #4caf50; height: 100%; width: 15%; border-radius: 5px;"></div>
                            </div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #0288d1; margin-bottom: 10px;">Ajustements recommand√©s</h4>
                            <ul style="color: #666; margin: 0; padding-left: 20px;">
                                <li>Augmenter les prot√©ines de 10g/jour</li>
                                <li>Introduire 1 jour de refeed par semaine</li>
                                <li>Varier les sources de glucides</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page-section">
                <h2 class="page-title">Profil et Objectifs</h2>
                <div class="profile-form">
                    <div class="form-group">
                        <label>Sexe</label>
                        <select id="gender">
                            <option value="homme">Homme</option>
                            <option value="femme">Femme</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>√Çge (ann√©es)</label>
                        <input type="number" id="age" value="31" min="1" max="120">
                    </div>
                    <div class="form-group">
                        <label>Taille (cm)</label>
                        <input type="number" id="height" value="180" min="100" max="250">
                    </div>
                    <div class="form-group">
                        <label>Poids actuel (kg)</label>
                        <input type="number" id="weight" value="96" min="30" max="300" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Objectif</label>
                        <select id="goal">
                            <option value="cut">Perte rapide (-1kg/semaine)</option>
                            <option value="cut-moderate">Perte mod√©r√©e (-0.5kg/semaine)</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="bulk-moderate">Prise mod√©r√©e (+0.5kg/semaine)</option>
                            <option value="bulk">Prise rapide (+1kg/semaine)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Niveau d'activit√© physique</label>
                        <select id="activity">
                            <option value="sedentary">S√©dentaire</option>
                            <option value="light">L√©g√®rement actif (exercice l√©ger 1-3x/semaine)</option>
                            <option value="moderate">Mod√©r√©ment actif (3-5x/semaine)</option>
                            <option value="active">Tr√®s actif (6-7x/semaine)</option>
                            <option value="athlete">Athl√®te (2x par jour)</option>
                        </select>
                    </div>

                    <div class="slider-container">
                        <label>R√©partition des prot√©ines (<span id="proteinPercent">30</span>%)</label>
                        <input type="range" id="proteinSlider" min="15" max="45" value="30" oninput="updateMacros()">
                        <div class="macro-recommendation">
                            <h4>üí™ Recommandations musculation :</h4>
                            <ul>
                                <li>‚Ä¢ D√©butant : 25-30% (1.6-2g/kg)</li>
                                <li>‚Ä¢ Interm√©diaire : 30-35% (2-2.5g/kg)</li>
                                <li>‚Ä¢ Avanc√©/Comp√©tition : 35-45% (2.5-3g/kg)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label>R√©partition des lipides (<span id="fatPercent">25</span>%)</label>
                        <input type="range" id="fatSlider" min="15" max="40" value="25" oninput="updateMacros()">
                        <div class="alert alert-warning">
                            ‚ö†Ô∏è <strong>Attention :</strong> Les glucides ne doivent pas descendre trop bas<br>
                            ‚Ä¢ Minimum recommand√© : 20-25% pour l'√©nergie<br>
                            ‚Ä¢ Si <20% : Risque de fatigue et baisse de performance
                        </div>
                    </div>

                    <div class="form-group">
                        <label>R√©partition des glucides</label>
                        <p style="font-size: 24px; font-weight: bold; color: #7c3aed;">
                            <span id="carbPercent">45</span>% (calcul√© automatiquement)
                        </p>
                    </div>

                    <div class="quick-calc">
                        <h4>üéØ Calcul rapide prot√©ines pour musculation</h4>
                        <div class="calc-input-group">
                            <input type="number" id="proteinPerKg" value="2.2" min="0" max="5" step="0.1" style="width: 100px;">
                            <span>g de prot√©ines par kg de poids corporel</span>
                            <button class="btn btn-success" onclick="calculateProteinRatio()">Calculer ratio %</button>
                        </div>
                        <div class="calc-result" id="proteinRatioResult">
                            R√©sultat : 46% de prot√©ines
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-primary" style="flex: 1;" onclick="calculateNeeds()">
                            Calculer mes besoins
                        </button>
                        <button class="btn btn-success" style="flex: 1;" onclick="saveProfile()">
                            Sauvegarder le profil
                        </button>
                    </div>
                </div>
            </div>

            <!-- Foods Page -->
            <div id="foods" class="page-section">
                <h2 class="page-title">üîç Recherche d'aliments</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Base de donn√©es Open Food Facts France ‚Ä¢ Plus de 2 millions de produits fran√ßais ‚Ä¢ 
                    <a href="#" style="color: #7c3aed;">En savoir plus</a>
                </p>

                <div style="margin-bottom: 30px;">
                    <p style="font-weight: 500; margin-bottom: 15px;">S√©lectionnez le type de repas :</p>
                    <div class="meal-selector">
                        <div class="meal-btn active">
                            <span style="font-size: 24px;">ü•ê</span>
                            <span>Petit-d√©jeuner</span>
                        </div>
                        <div class="meal-btn">
                            <span style="font-size: 24px;">üçù</span>
                            <span>D√©jeuner</span>
                        </div>
                        <div class="meal-btn">
                            <span style="font-size: 24px;">üçì</span>
                            <span>Collation</span>
                        </div>
                        <div class="meal-btn">
                            <span style="font-size: 24px;">üçñ</span>
                            <span>D√Æner</span>
                        </div>
                    </div>
                </div>

                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Rechercher un aliment fran√ßais">
                    <button class="btn btn-primary">üîç</button>
                    <button class="scan-btn">üì∏ Scanner</button>
                </div>

                <div style="background: #e3f2fd; padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                    <h4 style="color: #1976d2; margin-bottom: 10px;">‚ûï Ajouter un aliment personnalis√©</h4>
                    <button class="btn btn-primary" onclick="showAddFoodModal()">
                        Ajouter manuellement un aliment
                    </button>
                </div>

                <!-- Barcode Scanner -->
                <div style="background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">üì± Scanner de Code-barres</h3>
                    <p style="margin-bottom: 20px;">Scannez le code-barres d'un produit pour l'ajouter instant
